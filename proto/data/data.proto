syntax = "proto3";
package data;
option go_package = "github.com/braginantonev/mhserver/proto/data";

import "google/protobuf/empty.proto";

enum FileType {
    File = 0;
    Image = 1;
    Music = 2;
}

message DataInfo {
    string username = 1;
    string filename = 3;
    FileType filetype = 4;
    uint64 size = 5;
}

message Connection {
    string UUID = 1;
    uint64 chunkSize = 2;
    int32 chunksCount = 3;
}

message FilePart {
    bytes chunk = 1;
    int64 offset = 2;
}

message SaveChunk {
    string UUID = 1;
    FilePart data = 2;
}

message GetChunk {
    string UUID = 1;
    int32 chunkId = 2;
}

message SHASum {
    bytes sum = 1;
}

message Direction {
    string user = 1;
    string dir = 2;
}

message FileInfo {
    string name = 1;
    bool isDir = 2;
    uint64 size = 3;
    int64 modTime = 4;
}

message FilesList {
    repeated FileInfo infos = 1;
}

message Size {
    uint64 val = 1;
}

service DataService {
    rpc CreateConnection (DataInfo) returns (Connection);
    rpc SaveData (SaveChunk) returns (google.protobuf.Empty);
    rpc GetData (GetChunk) returns (FilePart);
    rpc GetSum (GetChunk) returns (SHASum);
    rpc GetFiles (Direction) returns (FilesList);
	rpc GetAvailableDiskSpace (Direction) returns (Size);
	rpc CreateDir (Direction) returns (google.protobuf.Empty);
	rpc RemoveDir (Direction) returns (google.protobuf.Empty);
}